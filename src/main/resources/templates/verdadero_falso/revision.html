<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/layout :: head('Resultados - Secuencia V/F')"></head>

<body class="bg-sky-50">
    <header th:replace="fragments/layout :: header"></header>

    <main class="container mx-auto p-6 max-w-4xl">
        <div class="mb-6 text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ Resultados Finales</h1>
            <p class="text-gray-600">Revisa tus respuestas y aprende de los errores</p>
        </div>

        <!-- Resumen de resultados -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-blue-100 rounded-lg shadow-sm p-6 text-center border border-blue-200">
                <div class="text-4xl font-bold text-blue-700" th:text="${total}">10</div>
                <div class="text-gray-600 text-sm mt-1">Total de Preguntas</div>
            </div>
            <div class="bg-green-100 rounded-lg shadow-sm p-6 text-center border border-green-200">
                <div class="text-4xl font-bold text-green-700" th:text="${correctCount}">7</div>
                <div class="text-gray-600 text-sm mt-1">Respuestas Correctas</div>
            </div>
            <div class="bg-red-100 rounded-lg shadow-sm p-6 text-center border border-red-200">
                <div class="text-4xl font-bold text-red-700" th:text="${incorrectCount}">3</div>
                <div class="text-gray-600 text-sm mt-1">Respuestas Incorrectas</div>
            </div>
        </div>

        <!-- Porcentaje de aciertos -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8 border border-gray-200">
            <div class="text-center">
                <div class="text-6xl font-bold mb-2"
                    th:classappend="${correctCount * 100 / total >= 70} ? 'text-green-600' : (${correctCount * 100 / total >= 50} ? 'text-yellow-600' : 'text-red-600')"
                    th:text="${#numbers.formatDecimal(correctCount * 100.0 / total, 1, 1)} + '%'">
                    70%
                </div>
                <div class="text-lg text-gray-600">Porcentaje de Aciertos</div>
                <div class="mt-4">
                    <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div class="h-4 rounded-full transition-all duration-500"
                            th:classappend="${correctCount * 100 / total >= 70} ? 'bg-green-600' : (${correctCount * 100 / total >= 50} ? 'bg-yellow-600' : 'bg-red-600')"
                            th:style="'width: ' + ${correctCount * 100 / total} + '%'">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detalle de cada pregunta -->
        <div class="space-y-4 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“ Detalle de Respuestas</h2>

            <div th:each="item, iterStat : ${items}" class="bg-white rounded-lg shadow-sm p-6 border-2"
                th:classappend="${item.correct} ? 'border-green-300' : 'border-red-300'">

                <!-- Encabezado de la pregunta -->
                <div class="flex items-start gap-3 mb-4">
                    <div class="flex-shrink-0">
                        <span th:if="${item.correct}" class="text-3xl">âœ…</span>
                        <span th:unless="${item.correct}" class="text-3xl">âŒ</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-sm font-semibold text-gray-500">Pregunta [[${iterStat.index + 1}]]</span>
                            <span th:if="${item.correct}"
                                class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Correcta</span>
                            <span th:unless="${item.correct}"
                                class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded">Incorrecta</span>
                        </div>
                        <p class="text-lg font-medium text-gray-800 whitespace-pre-wrap"
                            th:text="${item.question.statement}">
                            Enunciado de la pregunta
                        </p>
                    </div>
                </div>

                <!-- Respuestas -->
                <div class="ml-12 space-y-2">
                    <div th:if="${!item.correct}" class="bg-red-50 border border-red-200 rounded p-3">
                        <span class="text-sm font-semibold text-red-700">Tu respuesta:</span>
                        <span class="text-sm text-red-600 ml-2"
                            th:text="${item.userAnswer != null ? (item.userAnswer ? 'Verdadero' : 'Falso') : 'Sin responder'}">
                            Falso
                        </span>
                    </div>

                    <div class="bg-green-50 border border-green-200 rounded p-3">
                        <span class="text-sm font-semibold text-green-700">Respuesta correcta:</span>
                        <span class="text-sm text-green-600 ml-2"
                            th:text="${item.question.correctAnswer ? 'Verdadero' : 'Falso'}">
                            Verdadero
                        </span>
                    </div>

                    <!-- ExplicaciÃ³n si existe -->
                    <div th:if="${item.question.explanation != null and !item.question.explanation.isEmpty()}"
                        class="bg-blue-50 border border-blue-200 rounded p-3">
                        <span class="text-sm font-semibold text-blue-700">ğŸ’¡ ExplicaciÃ³n:</span>
                        <p class="text-sm text-blue-600 mt-1" th:text="${item.question.explanation}">
                            ExplicaciÃ³n de la respuesta correcta
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botones de acciÃ³n -->
        <div class="flex gap-4 justify-center">
            <form th:action="@{/vf/secuencia/reset}" method="post">
                <div th:replace="fragments/forms :: csrf"></div>
                <button type="submit" class="bg-blue-600 text-white px-8 py-3 rounded hover:bg-blue-700 font-semibold">
                    ğŸ”„ Reintentar Secuencia
                </button>
            </form>
            <a th:href="@{/vf/preguntas}"
                class="bg-gray-300 text-gray-700 px-8 py-3 rounded hover:bg-gray-400 font-semibold">
                ğŸ“‹ Ver Todas las Preguntas
            </a>
            <a th:href="@{/}" class="bg-green-600 text-white px-8 py-3 rounded hover:bg-green-700 font-semibold">
                ğŸ  Volver al Inicio
            </a>
        </div>
    </main>

    <footer th:replace="fragments/layout :: footer"></footer>
</body>

</html>